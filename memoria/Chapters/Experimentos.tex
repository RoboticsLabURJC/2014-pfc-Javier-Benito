% Chapter Template

\chapter{Experimentos}

\label{Chapter5} % Change X to a consecutive number; for referencing this chapter elsewhere, use \ref{ChapterX}

En este capítulo se detallarán las pruebas realizadas, con el objetivo de validar la solución propuesta en este trabajo. Además se comprobarán las diferentes configuraciones desarrolladas y se evaluarán sus prestaciones con los costes temporales. Estos experimentos han permitido depurar el componente para poder ajustar y mejorar la funcionalidad del mismo durante el desarrollo.

%-----------------------------------
%	SECTION Validación experimental
%-----------------------------------
\section{Validación experimental}

El entorno de pruebas utilizado ha sido siempre un entorno real, trabajando con los datos en vivo proporcionados por OpenniServer que extrae la información directamente del sensor.

Se propone en esta sección validar el componente en las diferentes fases que lo componen: detección de puntos de interés, cálculo de emparejamientos y estimación de movimiento.

\subsection{Detección de puntos de interés}



\subsection{Cálculo de emparejamientos}


\subsubsection{Posición estática}
\subsubsection{Traslación}
\subsubsection{Rotación}


\subsection{Resolución 3D}

La resolución 3D o estimación de movimiento compone el último paso que completa una iteración del sistema, por lo que en esta etapa podremos ver el resultado final del movimiento entre varios fotogramas consecutivos.

Las pruebas mostrados a continuación son realizadas con un funcionamiento normal del componente y en un tiempo determinado. El objetivo de estos experimentos es comprobar el comportamiento del sistema para los diferentes tipos de traslaciones ($x$, $y$, y $z$) y rotaciones (\textit{pitch}, \textit{yaw}, \textit{roll}).

Para estas pruebas y las siguientes se hará uso del componente con el comportamiento automático activado, repitiendo así de manera autónoma cada ciclo de estimación 3D. También se ha optado, para añadir robustez, el filtro de sobresaliencia y RANSAC.

\subsubsection{Validación de la traslación}

En la siguiente subsección se harán pruebas para comprobar como se comporta el sistema ante la traslación. Se moverá la cámara a lo largo de los tres ejes ($x$, $y$ y $z$) (Figura~\ref{fig:xyz}).

\begin{figure}[th]
\centering
\includegraphics[scale=0.3]{Figures/xyz.png}
\decoRule
\caption[Ejes de coordenadas $x$, $y$ y $z$]{Ejes de coordenadas $x$, $y$ y $z$, con la orientación de la cámara.}
\label{fig:xyz}
\end{figure}

Para estas pruebas se va a utilizar el mismo entorno de trabajo por lo que el punto de partida será el que se muestra en la Figura~\ref{fig:init}.

\begin{figure}[th]
\centering
\includegraphics[scale=0.3]{Figures/tests/init.png}
\decoRule
\caption[Punto de partida para las pruebas de traslación y rotación]{Punto de partida para las pruebas realizadas.}
\label{fig:init}
\end{figure}

En la Figura~\ref{fig:axis-y} se muestra la estimación de movimiento sobre el eje $y$. El desplazamiento se ha intentado hacer lo más recto posible y el recorrido se muestra como estela en el visor 3D del componente. En ambas capturas se puede ver la ida y la vuelta recorriendo por cada una 1.5 metros aproximadamente. Después se ha vuelto a la posición de origen del movimiento.

\begin{figure}[th]
\centering
\includegraphics[scale=0.3]{Figures/tests/axis-y.png}
\decoRule
\caption[Prueba con desplazamiento en el eje $y$]{Prueba con desplazamiento en el eje $y$.}
\label{fig:axis-y}
\end{figure}

Se puede observar, después de aproximadamente 100 iteraciones, como ha afectado el error a la estimación al volver el sensor al origen.

En la Figura~\ref{fig:axis-xz} se puede ver el efecto de la traslación en los ejes $x$ y $z$ respectivamente. Se ve como el error en estos ejes es menor, percibiendo oscilaciones en su mayor parte únicamente en el eje $y$. La validación del eje $x$ se ha realizado sobre una mesa recorriendo 1 metro, por lo que no se obtiene desplazamiento en $z$. En cuanto a las pruebas del eje $z$ se aprecia un balanceo en $x$ debido al movimiento vertical de la mano ya que no ha seguido una trayectoria recta.

\begin{figure}[th]
\centering
\includegraphics[scale=0.3]{Figures/tests/axis-x-z.png}
\decoRule
\caption[Prueba con desplazamiento en los ejes $x$ y $z$]{Prueba con desplazamiento en los ejes $x$ y $z$.}
\label{fig:axis-xz}
\end{figure}

Los resultados son aceptables en la estimación, no se consigue un cierre de trayectoria perfecto pero se acerca. Pensando que se ha aplicado una traslación de más de 1 metro el error final obtenido se puede medir en centímetros, acentuándose más para el eje $y$ correspondiente al perpendicular al plano imagen y el que se obtiene de la imagen de profundidad.

Como vimos en el capítulo \ref{Chapter3} la información de profundidad del sensor no es perfecta y tiene un pequeño margen de error. A parte de tener un rango de distancias óptimo establecido por el fabricante (\textit{0.8 to 3.5 m}), fuera de este rango la imagen de profundidad empieza a empeorar drásticamente y por consiguiente la estimación de movimiento.

\subsubsection{Validación de la Rotación}

\begin{figure}[th]
\centering
\includegraphics[scale=0.9]{Figures/pitch_yaw_roll.png}
\decoRule
\caption[Explicación gráfica del movimiento \textit{pitch}, \textit{yaw} y \textit{roll}]{Dibujo con los movimientos \textit{pitch}, \textit{yaw} y \textit{roll}.}
\label{fig:static3}
\end{figure}

\subsubsection{Validación de trayectorias complejas}

\subsection{Error estático}

El error estático muestra el ruido blanco que se esconde detrás de la resolución 3D en tiempo real. Como se va a poder observar en esta sección, el ruido estático es inevitable y no depende del algoritmo a utilizar. Sin embargo, en el siguiente capítulo, en el cual se propone posibles mejoras y líneas futuras, se verán métodos para poder elimnarlo en mayor o menor medida.

En las siguientes Figuras (\ref{fig:static1}, \ref{fig:static2}, \ref{fig:static3}) se puede ver un ejemplo de este error para diferentes configuraciones. Como se puede interpretar es un error que está presente en todos los casos.

\begin{figure}[th]
\centering
\includegraphics[scale=0.3]{Figures/tests/static-surf-flann_2.png}
\decoRule
\caption[Ruido estático, con SURF y FLANN]{Ruido estático después de 30 y 60 segundos, con SURF y FLANN.}
\label{fig:static1}
\end{figure}

\begin{figure}[th]
\centering
\includegraphics[scale=0.3]{Figures/tests/static-filter_2.png}
\decoRule
\caption[Ruido estático, con SIFT, Fuerza Bruta y filtros]{Ruido estático después de 30 y 60 segundos, con SIFT, Fuerza Bruta y filtros.}
\label{fig:static2}
\end{figure}

\begin{figure}[th]
\centering
\includegraphics[scale=0.3]{Figures/tests/static-ransac_2.png}
\decoRule
\caption[Ruido estático, con SIFT, Fuerza Bruta y RANSAC]{Ruido estático después de 30 y 60 segundos, con SIFT, Fuerza Bruta y RANSAC.}
\label{fig:static3}
\end{figure}

Las pruebas realizadas han sido capturadas a los 30 y 60 segundos respectivamente y la configuración aplicada se encuentra en la descripción de cada Figura.

Si analizamos las matrices RT obtenidas se puede observar que el eje en que más avanza el ruido es el eje $y$, al igual que pasaba en las pruebas de la sección anterior.


%-----------------------------------
%	SECTION Tiempos de procesado
%-----------------------------------
\section{Tiempos de procesado}